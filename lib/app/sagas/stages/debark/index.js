"use strict";require("core-js/modules/es.array.iterator");require("core-js/modules/es.object.get-own-property-descriptor");require("core-js/modules/es.object.to-string");require("core-js/modules/es.string.iterator");require("core-js/modules/es.weak-map");require("core-js/modules/web.dom-collections.iterator");Object.defineProperty(exports,"__esModule",{value:true});exports.watchDebarkRoute=watchDebarkRoute;exports.watchDebarkSubmit=watchDebarkSubmit;exports.watchDebarkFetch=watchDebarkFetch;exports.watchDebarkStore=watchDebarkStore;require("regenerator-runtime/runtime");var _effects=require("redux-saga/effects");var _shinkansenRails=require("shinkansen-rails");var _debark=require("../../../actions/stages/debark");var api=_interopRequireWildcard(require("../../../../api/stages/debark"));var _transformers=require("../../../transformers");var _getPathname=_interopRequireDefault(require("../../../common/get-pathname"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};if(obj!=null){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var _marked=regeneratorRuntime.mark(debarkRouteSaga),_marked2=regeneratorRuntime.mark(submitRouteSaga),_marked3=regeneratorRuntime.mark(fetchRouteSaga),_marked4=regeneratorRuntime.mark(storeRouteSaga),_marked5=regeneratorRuntime.mark(watchDebarkRoute),_marked6=regeneratorRuntime.mark(watchDebarkSubmit),_marked7=regeneratorRuntime.mark(watchDebarkFetch),_marked8=regeneratorRuntime.mark(watchDebarkStore);function debarkRouteSaga(_ref){var redirect,history,pathname,_history$location,currentPathname;return regeneratorRuntime.wrap(function debarkRouteSaga$(_context){while(1){switch(_context.prev=_context.next){case 0:redirect=_ref.redirect,history=_ref.history;pathname=(0,_getPathname.default)(redirect);if(pathname){_history$location=history.location;_history$location=_history$location===void 0?{}:_history$location;currentPathname=_history$location.pathname;if(pathname!==currentPathname)history.push(pathname);}case 3:case"end":return _context.stop();}}},_marked);}function submitRouteSaga(_ref2){var statement,history,_ref3,_ref3$data,response,redirect;return regeneratorRuntime.wrap(function submitRouteSaga$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:statement=_ref2.debark.statement,history=_ref2.history;_context2.prev=1;_context2.next=4;return storeRouteSaga({response:{statement:statement}});case 4:_context2.next=6;return(0,_effects.call)(api.submitRoute,{response:{debark:_shinkansenRails.Rails.rail(statement)}});case 6:_ref3=_context2.sent;_ref3$data=_ref3.data;response=_ref3$data===void 0?{}:_ref3$data;_context2.next=11;return(0,_effects.put)((0,_debark.submitRouteFulfilled)(response));case 11:redirect=response.redirect;_context2.next=14;return(0,_effects.put)((0,_debark.debarkRoute)(redirect,history));case 14:_context2.next=20;break;case 16:_context2.prev=16;_context2.t0=_context2["catch"](1);_context2.next=20;return(0,_effects.put)((0,_debark.submitRouteRejected)((0,_transformers.transformError)(_context2.t0)));case 20:case"end":return _context2.stop();}}},_marked2,null,[[1,16]]);}function fetchRouteSaga(){var _ref4,_ref4$data,response;return regeneratorRuntime.wrap(function fetchRouteSaga$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return(0,_effects.call)(api.fetchRoute);case 3:_ref4=_context3.sent;_ref4$data=_ref4.data;response=_ref4$data===void 0?{}:_ref4$data;_context3.next=8;return(0,_effects.put)((0,_debark.fetchRouteFulfilled)(response));case 8:_context3.next=14;break;case 10:_context3.prev=10;_context3.t0=_context3["catch"](0);_context3.next=14;return(0,_effects.put)((0,_debark.fetchRouteRejected)((0,_transformers.transformError)(_context3.t0)));case 14:case"end":return _context3.stop();}}},_marked3,null,[[0,10]]);}function storeRouteSaga(route){var _ref5,_ref5$data,response;return regeneratorRuntime.wrap(function storeRouteSaga$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return(0,_effects.call)(api.storeRoute,route);case 3:_ref5=_context4.sent;_ref5$data=_ref5.data;response=_ref5$data===void 0?{}:_ref5$data;_context4.next=8;return(0,_effects.put)((0,_debark.storeRouteFulfilled)(response));case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4["catch"](0);_context4.next=14;return(0,_effects.put)((0,_debark.storeRouteRejected)((0,_transformers.transformError)(_context4.t0)));case 14:case"end":return _context4.stop();}}},_marked4,null,[[0,10]]);}function watchDebarkRoute(){return regeneratorRuntime.wrap(function watchDebarkRoute$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return(0,_effects.takeLatest)(_debark.ROUTE,debarkRouteSaga);case 2:case"end":return _context5.stop();}}},_marked5);}function watchDebarkSubmit(){return regeneratorRuntime.wrap(function watchDebarkSubmit$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return(0,_effects.takeLatest)(_debark.SUBMIT,submitRouteSaga);case 2:case"end":return _context6.stop();}}},_marked6);}function watchDebarkFetch(){return regeneratorRuntime.wrap(function watchDebarkFetch$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return(0,_effects.takeLatest)(_debark.FETCH,fetchRouteSaga);case 2:case"end":return _context7.stop();}}},_marked7);}function watchDebarkStore(){return regeneratorRuntime.wrap(function watchDebarkStore$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return(0,_effects.takeLatest)(_debark.STORE,storeRouteSaga);case 2:case"end":return _context8.stop();}}},_marked8);}