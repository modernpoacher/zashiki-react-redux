"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}Object.defineProperty(exports,"__esModule",{value:true});exports.watchOmegaRoute=watchOmegaRoute;exports.watchOmegaChange=watchOmegaChange;exports.watchOmegaSubmit=watchOmegaSubmit;exports.watchOmegaFetch=watchOmegaFetch;exports.watchOmegaStore=watchOmegaStore;exports.watchOmegaQuery=watchOmegaQuery;require("regenerator-runtime/runtime");var _effects=require("redux-saga/effects");var _shinkansenSignals=require("shinkansen-signals");var _omega=require("../../../actions/stages/omega");var api=_interopRequireWildcard(require("../../../../api/stages/omega"));var _transformers=require("../../../transformers");var _getPathname=_interopRequireDefault(require("../../../common/get-pathname"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var _marked=regeneratorRuntime.mark(omegaRouteSaga),_marked2=regeneratorRuntime.mark(changeRouteSaga),_marked3=regeneratorRuntime.mark(submitRouteSaga),_marked4=regeneratorRuntime.mark(fetchRouteSaga),_marked5=regeneratorRuntime.mark(storeRouteSaga),_marked6=regeneratorRuntime.mark(queryRouteSaga),_marked7=regeneratorRuntime.mark(watchOmegaRoute),_marked8=regeneratorRuntime.mark(watchOmegaChange),_marked9=regeneratorRuntime.mark(watchOmegaSubmit),_marked10=regeneratorRuntime.mark(watchOmegaFetch),_marked11=regeneratorRuntime.mark(watchOmegaStore),_marked12=regeneratorRuntime.mark(watchOmegaQuery);var OMEGA=_shinkansenSignals.Signals.OMEGA;var getState=function getState(_ref){var _ref$OMEGA=_ref[OMEGA],omega=_ref$OMEGA===void 0?{}:_ref$OMEGA;return omega;};var hasStoreError=function hasStoreError(_ref2){var _ref2$OMEGA=_ref2[OMEGA],omega=_ref2$OMEGA===void 0?{}:_ref2$OMEGA;return'error'in omega;};var hasQueryError=function hasQueryError(_ref3){var _ref3$OMEGA=_ref3[OMEGA],omega=_ref3$OMEGA===void 0?{}:_ref3$OMEGA;return'error'in omega;};function omegaRouteSaga(_ref4){var redirect,history,pathname,_history$location,currentPathname;return regeneratorRuntime.wrap(function omegaRouteSaga$(_context){while(1){switch(_context.prev=_context.next){case 0:redirect=_ref4.redirect,history=_ref4.history;pathname=(0,_getPathname.default)(redirect);if(pathname){_history$location=history.location;_history$location=_history$location===void 0?{}:_history$location;currentPathname=_history$location.pathname;if(pathname!==currentPathname)history.push(pathname);}case 3:case"end":return _context.stop();}}},_marked);}function changeRouteSaga(_ref5){var route,_ref6,_ref6$data,response;return regeneratorRuntime.wrap(function changeRouteSaga$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:route=_ref5.route;_context2.prev=1;_context2.next=4;return(0,_effects.call)(api.changeRoute,route);case 4:_ref6=_context2.sent;_ref6$data=_ref6.data;response=_ref6$data===void 0?{}:_ref6$data;_context2.next=9;return(0,_effects.put)((0,_omega.changeRouteFulfilled)(response));case 9:_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2["catch"](1);_context2.next=15;return(0,_effects.put)((0,_omega.changeRouteRejected)((0,_transformers.transformError)(_context2.t0)));case 15:case"end":return _context2.stop();}}},_marked2,null,[[1,11]]);}function submitRouteSaga(_ref7){var route,history,hasError,_hasError,state,redirect,_history;return regeneratorRuntime.wrap(function submitRouteSaga$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:route=_ref7.route,history=_ref7.history;_context3.next=3;return(0,_effects.put)((0,_omega.storeRoute)(route,history));case 3:_context3.next=5;return(0,_effects.race)([(0,_effects.take)(_omega.STORE_FULFILLED),(0,_effects.take)(_omega.STORE_REJECTED)]);case 5:_context3.next=7;return(0,_effects.select)(hasStoreError);case 7:hasError=_context3.sent;if(!hasError){_context3.next=13;break;}_context3.next=11;return(0,_effects.put)((0,_omega.submitRouteRejected)());case 11:_context3.next=33;break;case 13:_context3.next=15;return(0,_effects.put)((0,_omega.queryRoute)());case 15:_context3.next=17;return(0,_effects.race)([(0,_effects.take)(_omega.QUERY_FULFILLED),(0,_effects.take)(_omega.QUERY_REJECTED)]);case 17:_context3.next=19;return(0,_effects.select)(hasQueryError);case 19:_hasError=_context3.sent;if(!_hasError){_context3.next=25;break;}_context3.next=23;return(0,_effects.put)((0,_omega.submitRouteRejected)());case 23:_context3.next=33;break;case 25:_context3.next=27;return(0,_effects.select)(getState);case 27:state=_context3.sent;_context3.next=30;return(0,_effects.put)((0,_omega.submitRouteFulfilled)(state));case 30:redirect=state.redirect,_history=state.history;_context3.next=33;return(0,_effects.put)((0,_omega.omegaRoute)(redirect,_history));case 33:case"end":return _context3.stop();}}},_marked3);}function fetchRouteSaga(){var _ref8,_ref8$data,response;return regeneratorRuntime.wrap(function fetchRouteSaga$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return(0,_effects.call)(api.fetchRoute);case 3:_ref8=_context4.sent;_ref8$data=_ref8.data;response=_ref8$data===void 0?{}:_ref8$data;_context4.next=8;return(0,_effects.put)((0,_omega.fetchRouteFulfilled)(response));case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4["catch"](0);_context4.next=14;return(0,_effects.put)((0,_omega.fetchRouteRejected)((0,_transformers.transformError)(_context4.t0)));case 14:case"end":return _context4.stop();}}},_marked4,null,[[0,10]]);}function storeRouteSaga(_ref9){var route,_ref10,_ref10$data,response;return regeneratorRuntime.wrap(function storeRouteSaga$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:route=_ref9.route;_context5.prev=1;_context5.next=4;return(0,_effects.call)(api.storeRoute,route);case 4:_ref10=_context5.sent;_ref10$data=_ref10.data;response=_ref10$data===void 0?{}:_ref10$data;_context5.next=9;return(0,_effects.put)((0,_omega.storeRouteFulfilled)(response));case 9:_context5.next=15;break;case 11:_context5.prev=11;_context5.t0=_context5["catch"](1);_context5.next=15;return(0,_effects.put)((0,_omega.storeRouteRejected)((0,_transformers.transformError)(_context5.t0)));case 15:case"end":return _context5.stop();}}},_marked5,null,[[1,11]]);}function queryRouteSaga(){var _ref11,_ref11$data,response;return regeneratorRuntime.wrap(function queryRouteSaga$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return(0,_effects.call)(api.queryRoute);case 3:_ref11=_context6.sent;_ref11$data=_ref11.data;response=_ref11$data===void 0?{}:_ref11$data;_context6.next=8;return(0,_effects.put)((0,_omega.queryRouteFulfilled)(response));case 8:_context6.next=14;break;case 10:_context6.prev=10;_context6.t0=_context6["catch"](0);_context6.next=14;return(0,_effects.put)((0,_omega.queryRouteRejected)((0,_transformers.transformError)(_context6.t0)));case 14:case"end":return _context6.stop();}}},_marked6,null,[[0,10]]);}function watchOmegaRoute(){return regeneratorRuntime.wrap(function watchOmegaRoute$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return(0,_effects.takeLatest)(_omega.ROUTE,omegaRouteSaga);case 2:case"end":return _context7.stop();}}},_marked7);}function watchOmegaChange(){return regeneratorRuntime.wrap(function watchOmegaChange$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return(0,_effects.takeLatest)(_omega.CHANGE,changeRouteSaga);case 2:case"end":return _context8.stop();}}},_marked8);}function watchOmegaSubmit(){return regeneratorRuntime.wrap(function watchOmegaSubmit$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return(0,_effects.takeLatest)(_omega.SUBMIT,submitRouteSaga);case 2:case"end":return _context9.stop();}}},_marked9);}function watchOmegaFetch(){return regeneratorRuntime.wrap(function watchOmegaFetch$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return(0,_effects.takeLatest)(_omega.FETCH,fetchRouteSaga);case 2:case"end":return _context10.stop();}}},_marked10);}function watchOmegaStore(){return regeneratorRuntime.wrap(function watchOmegaStore$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return(0,_effects.takeLatest)(_omega.STORE,storeRouteSaga);case 2:case"end":return _context11.stop();}}},_marked11);}function watchOmegaQuery(){return regeneratorRuntime.wrap(function watchOmegaQuery$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return(0,_effects.takeLatest)(_omega.QUERY,queryRouteSaga);case 2:case"end":return _context12.stop();}}},_marked12);}