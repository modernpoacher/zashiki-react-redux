"use strict";require("core-js/modules/es.array.iterator");require("core-js/modules/es.object.get-own-property-descriptor");require("core-js/modules/es.object.to-string");require("core-js/modules/es.string.iterator");require("core-js/modules/es.weak-map");require("core-js/modules/web.dom-collections.iterator");Object.defineProperty(exports,"__esModule",{value:true});exports.watchEmbarkFetch=watchEmbarkFetch;exports.watchEmbarkStore=watchEmbarkStore;exports.watchEmbarkSubmit=watchEmbarkSubmit;require("regenerator-runtime/runtime");var _effects=require("redux-saga/effects");var _boom=_interopRequireDefault(require("@hapi/boom"));var _shinkansenRails=require("shinkansen-rails");var _embark=require("../../../actions/stages/embark");var api=_interopRequireWildcard(require("../../../../api/stages/embark"));function _getRequireWildcardCache(){if(typeof WeakMap!=="function")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};if(obj!=null){var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var _marked=regeneratorRuntime.mark(fetchRoute),_marked2=regeneratorRuntime.mark(storeRoute),_marked3=regeneratorRuntime.mark(submitRoute),_marked4=regeneratorRuntime.mark(watchEmbarkFetch),_marked5=regeneratorRuntime.mark(watchEmbarkStore),_marked6=regeneratorRuntime.mark(watchEmbarkSubmit);function fetchRoute(){var _ref,_ref$data,response;return regeneratorRuntime.wrap(function fetchRoute$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log('fetchRoute');_context.prev=1;_context.next=4;return(0,_effects.call)(api.fetchRoute);case 4:_ref=_context.sent;_ref$data=_ref.data;response=_ref$data===void 0?{}:_ref$data;_context.next=9;return(0,_effects.put)((0,_embark.fetchRouteFulfilled)(response));case 9:_context.next=15;break;case 11:_context.prev=11;_context.t0=_context["catch"](1);_context.next=15;return(0,_effects.put)((0,_embark.fetchRouteRejected)(_boom.default.badImplementation(_context.t0)));case 15:case"end":return _context.stop();}}},_marked,null,[[1,11]]);}function storeRoute(route){var _ref2,_ref2$data,response;return regeneratorRuntime.wrap(function storeRoute$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('storeRoute',route);_context2.prev=1;_context2.next=4;return(0,_effects.call)(api.storeRoute,route);case 4:_ref2=_context2.sent;_ref2$data=_ref2.data;response=_ref2$data===void 0?{}:_ref2$data;_context2.next=9;return(0,_effects.put)((0,_embark.storeRouteFulfilled)(response));case 9:_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2["catch"](1);_context2.next=15;return(0,_effects.put)((0,_embark.storeRouteRejected)(_boom.default.badImplementation(_context2.t0)));case 15:case"end":return _context2.stop();}}},_marked2,null,[[1,11]]);}function submitRoute(_ref3){var statement,history,_ref4,_ref4$data,response;return regeneratorRuntime.wrap(function submitRoute$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:statement=_ref3.route.statement,history=_ref3.history;console.log('submitRoute',statement,history);_context3.prev=2;_context3.next=5;return storeRoute({response:{statement:statement}});case 5:_context3.next=7;return(0,_effects.call)(api.submitRoute,{response:{embark:_shinkansenRails.Rails.rail(statement)}});case 7:_ref4=_context3.sent;_ref4$data=_ref4.data;response=_ref4$data===void 0?{}:_ref4$data;_context3.next=12;return(0,_effects.put)((0,_embark.submitRouteFulfilled)(response));case 12:_context3.next=14;return(0,_effects.put)((0,_embark.embarkRoute)(response,history));case 14:_context3.next=20;break;case 16:_context3.prev=16;_context3.t0=_context3["catch"](2);_context3.next=20;return(0,_effects.put)((0,_embark.submitRouteRejected)(_boom.default.badImplementation(_context3.t0)));case 20:case"end":return _context3.stop();}}},_marked3,null,[[2,16]]);}function watchEmbarkFetch(){return regeneratorRuntime.wrap(function watchEmbarkFetch$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return(0,_effects.takeLatest)(_embark.FETCH,fetchRoute);case 2:case"end":return _context4.stop();}}},_marked4);}function watchEmbarkStore(){return regeneratorRuntime.wrap(function watchEmbarkStore$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return(0,_effects.takeLatest)(_embark.STORE,storeRoute);case 2:case"end":return _context5.stop();}}},_marked5);}function watchEmbarkSubmit(){return regeneratorRuntime.wrap(function watchEmbarkSubmit$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return(0,_effects.takeLatest)(_embark.SUBMIT,submitRoute);case 2:case"end":return _context6.stop();}}},_marked6);}